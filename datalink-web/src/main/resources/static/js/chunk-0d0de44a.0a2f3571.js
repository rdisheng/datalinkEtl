(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0d0de44a"],{2909:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a("6b75");function i(e){if(Array.isArray(e))return Object(n["a"])(e)}a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("a630");function o(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}var s=a("06c5");function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e){return i(e)||o(e)||Object(s["a"])(e)||r()}},"312c":function(e,t,a){"use strict";a.r(t);a("b64b"),a("07ac");var n=function(){var e=this,t=e._self._c;return t("div",[t("a-row",{directives:[{name:"show",rawName:"v-show",value:!e.disableEdit,expression:"!disableEdit"}],staticStyle:{width:"100%","padding-bottom":"10px"}},[t("a-col",{attrs:{span:18}},[t("a-space",{attrs:{size:"small"}},[t("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:e.newItem}},[e._v("添加")]),t("a-upload",{attrs:{showUploadList:!1,beforeUpload:function(t){return e.checkFile(t,5,["xlsx"])},customRequest:e.customRequest},on:{change:e.handlerUpload}},[t("a-button",{attrs:{icon:"upload"}},[e._v("导入")])],1),t("a-button",{attrs:{icon:"download"},on:{click:function(t){return e.download(!1)}}},[e._v("导出")]),t("a-popconfirm",{attrs:{title:"删除选中点位？"},on:{confirm:e.removeBatch}},[t("a-button",{directives:[{name:"show",rawName:"v-show",value:e.selectedRowKeys.length>0,expression:"selectedRowKeys.length > 0"}],attrs:{type:"danger",icon:"delete"}},[e._v(" 删除选中("+e._s(e.selectedRowKeys.length)+") ")])],1)],1)],1),t("a-col",{staticStyle:{"text-align":"right"},attrs:{span:6}},[t("a-button",{attrs:{type:"link",icon:"download"},on:{click:function(t){return e.download(!0)}}},[e._v("下载模板 ")])],1)],1),t("a-table",{staticStyle:{border:"1px #e8e3e3 solid"},attrs:{columns:e.columns,dataSource:e.data,pagination:!1,loading:e.loading,size:"middle","row-selection":e.disableEdit?null:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},scroll:{y:400}},scopedSlots:e._u([e._l(Object.keys(e.fieldMap),(function(a,n){return{key:a,fn:function(i,o){return[o.editable?t("a-input",{key:a,staticStyle:{margin:"-5px 0"},attrs:{value:i,placeholder:Object.values(e.fieldMap)[n]},on:{change:function(t){return e.handleChange(t.target.value,o.key,a)}}}):[e._v(e._s(i))]]}}})),{key:"index",fn:function(t,a,n){return[e._v(" "+e._s(n+1)+" ")]}},{key:"action",fn:function(a,n){return[n.editable?[n.isNew?t("span",[t("a",{on:{click:function(t){return e.saveRow(n)}}},[e._v("确定")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-popconfirm",{attrs:{title:"删除此点位？"},on:{confirm:function(t){return e.remove(n.key)}}},[t("a",[e._v("删除")])])],1):t("span",[t("a",{on:{click:function(t){return e.saveRow(n)}}},[e._v("保存")]),t("a-divider",{attrs:{type:"vertical"}}),t("a",{on:{click:function(t){return e.cancel(n.key)}}},[e._v("取消")])],1)]:t("span",[t("a",{on:{click:function(t){return e.toggle(n.key)}}},[e._v("编辑")]),t("a-divider",{attrs:{type:"vertical"}}),t("a-popconfirm",{attrs:{title:"删除此点位？"},on:{confirm:function(t){return e.remove(n.key)}}},[t("a",[e._v("删除")])])],1)]}}],null,!0)})],1)},i=[],o=a("2909"),s=a("5530"),r=a("b85c"),d=(a("d3b7"),a("25f0"),a("4de4"),a("7db0"),a("159b"),a("3ca3"),a("ddb0"),a("2b3d"),a("9861"),a("ca00")),c=a("0fea"),l={name:"OpcUAPointsModel",props:{disableEdit:{type:Boolean,default:!1}},data:function(){return{loading:!1,data:[],selectedRowKeys:[],fieldMap:{tag:"标签",address:"地址"},columns:[{title:"#",dataIndex:"index",width:"10%",scopedSlots:{customRender:"index"}},{title:"标签",dataIndex:"tag",key:"tag",width:"25%",scopedSlots:{customRender:"tag"}},{title:"地址",dataIndex:"address",key:"address",width:"45%",scopedSlots:{customRender:"address"}}]}},mounted:function(){this.disableEdit||this.columns.push({title:"操作",key:"action",scopedSlots:{customRender:"action"}})},methods:{checkFile:d["a"],set:function(e){if(this.data=[],e){var t,a=1,n=Object(r["a"])(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.data.push({key:a++,tag:i.tag,address:i.address,editable:!1,isNew:!1})}}catch(o){n.e(o)}finally{n.f()}}},get:function(){var e,t=[],a=Object(r["a"])(this.data);try{for(a.s();!(e=a.n()).done;){var n=e.value;n.isNew||t.push({tag:n.tag,address:n.address})}}catch(i){a.e(i)}finally{a.f()}return t},newItem:function(){var e=this.data.length;this.data.push({key:0===e?"1":(parseInt(this.data[e-1].key)+1).toString(),tag:"",address:"",editable:!0,isNew:!0})},remove:function(e){this.data=this.data.filter((function(t){return t.key!==e})),this.selectedRowKeys=this.selectedRowKeys.filter((function(t){return t!==e}))},removeBatch:function(){var e=this;this.data=this.data.filter((function(t){return-1===e.selectedRowKeys.indexOf(t.key)})),this.selectedRowKeys=[]},saveRow:function(e){this.loading=!0;var t=e.key,a=e.tag,n=e.address;if(!a||!n)return this.loading=!1,void this.$message.error("填写不完整");var i=this.data.find((function(e){return e.key===t}));i.editable=!1,i.isNew=!1,this.loading=!1},toggle:function(e){var t=this.data.find((function(t){return t.key===e}));t._originalData=Object(s["a"])({},t),t.editable=!t.editable},cancel:function(e){var t=this.data.find((function(t){return t.key===e}));Object.keys(t).forEach((function(e){t[e]=t._originalData[e]})),t._originalData=void 0},handleChange:function(e,t,a){var n=Object(o["a"])(this.data),i=n.find((function(e){return t===e.key}));i&&(i[a]=e,this.data=n)},handlerUpload:function(e){if("done"===e.file.status)if(200===e.file.response.code){var t,a=e.file.response.data,n=this.data.length,i=n?parseInt(this.data[n-1].key):0,o=Object(r["a"])(a);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.key=(++i).toString(),s.editable=!1,s.isNew=!1,this.data.push(s)}}catch(d){o.e(d)}finally{o.f()}this.$message.success("已导入"+a.length+"个点位")}else this.$message.error("上传出错,".concat(e.file.response.message));else"error"===e.file.status&&this.$message.error("上传出错")},customRequest:function(e){var t=this,a=new FormData,n={};Object.keys(this.fieldMap).forEach((function(e){n[t.fieldMap[e]]=e})),a.append("file",e.file),a.append("field",JSON.stringify(n)),Object(c["f"])("/api/rule/points/import",a).then((function(t){e.onSuccess(t,e.file)}))},download:function(e){var t=e?[]:this.get(),a=e?"opcua_template.xlsx":"opcua_".concat(Object(d["c"])(),".xlsx");Object(c["b"])("/api/rule/points/export",{data:t,fieldMap:this.fieldMap,fileName:a}).then((function(e){var t=new Blob([e]),n=document.createElement("a"),i=window.URL.createObjectURL(t);n.href=i,n.download=decodeURIComponent(a),document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(i)}))},onSelectChange:function(e){this.selectedRowKeys=e}}},u=l,f=a("2877"),h=Object(f["a"])(u,n,i,!1,null,null,null);t["default"]=h.exports}}]);